# 架构（Chrome）

## 多进程架构
![多进程架构](../image/structure-chrome-multi-process.png)

- 浏览器进程：主要负责界面显示、用户交互、子进程管理，同时提供存储等功能。
- 渲染进程：核心任务是将 HTML、CSS 和 JavaScript 转换为用户可以与之交互的网页，排版引擎 Blink 和 JavaScript 引擎 V8 都是运行在该进程中，默认情况下，Chrome 会为每个 Tab 标签创建一个渲染进程。出于安全考虑，渲染进程都是运行在沙箱模式下。
- GPU 进程：其实，Chrome 刚开始发布的时候是没有 GPU 进程的。而 GPU 的使用初衷是为了实现 3D CSS 的效果，只是随后网页、Chrome 的 UI 界面都选择采用 GPU 来绘制，这使得 GPU 成为浏览器普遍的需求。最后，Chrome 在其多进程架构上也引入了 GPU 进程。
- 网络进程：主要负责页面的网络资源加载，之前是作为一个模块运行在浏览器进程里面的，直至最近才独立出来，成为一个单独的进程。
- 插件进程：主要是负责插件的运行，因插件易崩溃，所以需要通过插件进程来隔离，以保证插件进程崩溃不会对浏览器和页面造成影响。

### 优点
相对于单进程
- 更稳定
- 更流畅
- 更安全
安全性隐患：插件可以获取到操作系统的任意资源，页面脚本可以通过浏览器的漏洞来获取系统权限。因此，采用多进程架构使用安全沙箱来阻止上述安全隐患


### 缺点
- 更高的资源占用：因为每个进程都会包含公共基础结构的副本（如 JavaScript 运行环境），这就意味着浏览器会消耗更多的内存资源。
更复杂的体系架构：浏览器各模块之间耦合性高、扩展性差等问题，会导致现在的架构已经很难适应新的需求了。

## 未来：面向服务架构（SOA）
![SOA](../image/structure-chrome-SOA.png)

### 弹性
在资源不足的设备上，将服务合并到浏览器进程中
![弹性](../image/structure-chrome-SOA-2.png)

## 策略
在某视频网站追剧，打开多个标签，一个标签崩溃，所有*同站*的标签一起崩溃。  

采取 `process-per-site-instance` 策略，同站页面分配到同一个渲染进程，共用。
在一个渲染进程里面，这些页面就会共享JS的执行环境，也就是说A页面可以直接在B页面中执行脚本。因为是同一家的站点，所以是有这个需求的。

chrome输出的实际上是图片，如果卡住了也只是当前画面不更新了而已。